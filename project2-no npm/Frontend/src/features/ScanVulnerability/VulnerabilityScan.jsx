import { Form, useNavigation } from 'react-router-dom';
import Heading from '../../ui/Heading';
import ScanFrom from '../../ui/ScanFrom';
import VideoLoader from '../../ui/VideoLoader';
import { vulnerabilityScan } from '../../services/vulnerability';
import validator from 'validator';

function VulnerabilityScan() {
  const navigation = useNavigation();
  return (
    <div className="flex-1 bg-gray-50 pt-9">
      <Heading>vulnerability scan</Heading>
      <Form method="POST">
        <ScanFrom isSubmitting={navigation.state} />
        {navigation.state === 'submitting' && <VideoLoader />}
      </Form>
    </div>
  );
}

export async function action({ request }) {
  const formData = await request.formData();
  const data = Object.fromEntries(formData);
  if (!data?.url) return null;

	if (!validator.isURL(data?.url)) return { message: 'Provide a valid Url' };
	
	console.log(data.url)

  const vunerabilitScanData = await vulnerabilityScan(data.url);
  return vunerabilitScanData;
}

export default VulnerabilityScan;
